!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.validator=r()}(this,function(){"use strict";var e={email:function(e){return/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e)},max:function(e,r){return e=+e,!isNaN(e)&&e<=r},maxlength:function(e,r){return!e||e.length<=r},min:function(e,r){return e=+e,!isNaN(e)&&e>=r},minlength:function(e,r){return e&&e.length>=r},number:function(e){return""!=e&&e==+e&&isFinite(e)},regex:function(e,r){return!!r&&new RegExp(r).test(e)},required:function(e,r){return r&&"string"==typeof e&&(e=e.trim()),void 0!==e&&null!==e&&""!==e}},r=function(e,r){this.success=e,this.errors=r};r.prototype={ok:function(){return!!this.success},getErrors:function(){return this.errors||[]},getFirstError:function(){return this.errors&&this.errors[0]||null}};var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=(function(){function e(e){this.value=e}function r(r){function n(o,i){try{var u=r[o](i),a=u.value;a instanceof e?Promise.resolve(a.value).then(function(e){n("next",e)},function(e){n("throw",e)}):t(u.done?"return":"normal",u.value)}catch(e){t("throw",e)}}function t(e,r){switch(e){case"return":o.resolve({value:r,done:!0});break;case"throw":o.reject(r);break;default:o.resolve({value:r,done:!1})}(o=o.next)?n(o.key,o.arg):i=null}var o,i;this._invoke=function(e,r){return new Promise(function(t,u){var a={key:e,arg:r,resolve:t,reject:u,next:null};i?i=i.next=a:(o=i=a,n(e,r))})},"function"!=typeof r.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=function(){return this}),r.prototype.next=function(e){return this._invoke("next",e)},r.prototype.throw=function(e){return this._invoke("throw",e)},r.prototype.return=function(e){return this._invoke("return",e)}}(),function(e){return e&&e.then&&"function"==typeof e.then}),o=function(r,n,o){var i=r[n],u=o.rule,a=o.errorMsg,f=o.params,s=u;if("string"==typeof s&&!(s=e[u]))return{name:n,message:"无此校验规则:"+s};var c=[i];void 0!==f&&(Array.isArray(f)?c.push.apply(c,f):c.push(f));var l=s.apply(r,c);return t(l)?l.then(function(e){return e?null:{name:n,message:a}}).catch(function(e){return{name:n,message:a}}):l?null:{name:n,message:a}},i=function(e,r,n){var o=!1;return t(n)?(r.push(n),o=!0):n&&(e.push(n),r.push(n)),o};return{validate:function(e,n){if(!e||!n)return new r(!1,["校验缺少参数"]);var t=[],u=[],a=!1;return Object.keys(n).forEach(function(r){var f=n[r];Array.isArray(f)?f.forEach(function(n){i(t,u,o(e,r,n))&&(a=!0)}):i(t,u,o(e,r,f))&&(a=!0)}),a?Promise.all(u).then(function(e){return t=e.filter(function(e){return!!e}),new r(0===t.length,t)}):new r(0===t.length,t)},register:function r(t){if(!t||"object"!==(void 0===t?"undefined":n(t)))return console.error("register rule failed: must be an object or an array"),!1;if(Array.isArray(t)){var o=!0;return t.forEach(function(e){r(e)||(o=!1)}),o}var i=t.name;if(!i)return console.error("register rule failed: no name specified"),!1;if(e[i])return console.error("register rule failed: duplicate name"),!1;var u=t.validate;return u&&"function"==typeof u?(e[i]=u,!0):(console.error("register rule failed: no validate function specified"),!1)}}});
