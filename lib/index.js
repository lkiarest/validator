!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.validator=n()}(this,function(){"use strict";var e={email:function(e){return/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e)},max:function(e,n){return e=+e,!isNaN(e)&&e<=n},maxlength:function(e,n){return!e||e.length<=n},min:function(e,n){return e=+e,!isNaN(e)&&e>=n},minlength:function(e,n){return e&&e.length>=n},number:function(e){return""!=e&&e==+e&&isFinite(e)},regex:function(e,n){return!!n&&new RegExp(n).test(e)},required:function(e){return void 0!==e&&null!==e&&""!==e}},n=function(e,n){this.success=e,this.errors=n};n.prototype={ok:function(){return!!this.success},getErrors:function(){return this.errors||[]},getFirstError:function(){return this.errors&&this.errors[0]||null}};var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=(function(){function e(e){this.value=e}function n(n){function r(o,u){try{var i=n[o](u),a=i.value;a instanceof e?Promise.resolve(a.value).then(function(e){r("next",e)},function(e){r("throw",e)}):t(i.done?"return":"normal",i.value)}catch(e){t("throw",e)}}function t(e,n){switch(e){case"return":o.resolve({value:n,done:!0});break;case"throw":o.reject(n);break;default:o.resolve({value:n,done:!1})}(o=o.next)?r(o.key,o.arg):u=null}var o,u;this._invoke=function(e,n){return new Promise(function(t,i){var a={key:e,arg:n,resolve:t,reject:i,next:null};u?u=u.next=a:(o=u=a,r(e,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)}}(),function(e){return e&&e.then&&"function"==typeof e.then}),o=function(n,r,o){var u=n[r],i=o.rule,a=o.errorMsg,f=o.params,s=i;if("string"==typeof s&&!(s=e[i]))return{name:r,message:"无此校验规则:"+s};var c=[u];void 0!==f&&(Array.isArray(f)?c.push.apply(c,f):c.push(f));var l=s.apply(n,c);return t(l)?l.then(function(e){return e?null:{name:r,message:a}}).catch(function(e){return{name:r,message:a}}):l?null:{name:r,message:a}},u=function(e,n,r){var o=!1;return t(r)?(n.push(r),o=!0):r&&(e.push(r),n.push(r)),o};return{validate:function(e,r){if(!e||!r)return new n(!1,["校验缺少参数"]);var t=[],i=[],a=!1;return Object.keys(r).forEach(function(n){var f=r[n];Array.isArray(f)?f.forEach(function(r){u(t,i,o(e,n,r))&&(a=!0)}):u(t,i,o(e,n,f))&&(a=!0)}),a?Promise.all(i).then(function(e){return t=e.filter(function(e){return!!e}),new n(0===t.length,t)}):new n(0===t.length,t)},register:function n(t){if(!t||"object"!==(void 0===t?"undefined":r(t)))return console.error("register rule failed: must be an object or an array"),!1;if(Array.isArray(t)){var o=!0;return t.forEach(function(e){n(e)||(o=!1)}),o}var u=t.name;if(!u)return console.error("register rule failed: no name specified"),!1;if(e[u])return console.error("register rule failed: duplicate name"),!1;var i=t.validate;return i&&"function"==typeof i?(e[u]=i,!0):(console.error("register rule failed: no validate function specified"),!1)}}});
